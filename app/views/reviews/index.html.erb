<section class="section mt-6">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-10">
        <div class="card mb-6">
          <header class="card-header">
            <p class="card-header-title">
              <%= @store.name %>
            </p>
            <p class="card-header-title">
              <%= @store.address %>
            </p>
            <p class="card-header-title">
              <%= @store.nearest_station %>
            </p>
          </header>
          <div class="card-content">
            <div class="content average-score">
              <div class="star-rating mb-2">
                <div class="star-rating-front" style="width: <%= @store.reviews_score_percentage %>%">★★★★★</div>
                <div class="star-rating-back">★★★★★</div>
              </div>
              <div class="average-score-display ml-3 pt-2">
                <%= @store.avg_score %>点（<%= @store.reviews.count %>件のレビュー）
              </div>
            </div>
          </div>
          <footer class="card-footer">
            <%= link_to store_path(@store), class: "button card-footer-item" do %>
              レビューを書く
            <% end %>
            <%= link_to stores_path, class: "button card-footer-item" do %>
              店名一覧にもどる
            <% end %>
          </footer>
        </div>
      </div>
    </div>
  </div>
</section>
<h1 class="title">
  <p class="has-text-weight-bold has-text-centered">
    レビュー一覧
  </p>
</h1>
<section class="section" style="background: white;">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-10">
        <% @reviews.each do |review| %>
          <div class="card mt-6">
            <div class="card-content">
              <div class="content top-page-score has-text-right">
                <div class="star-rating mb-2">
                  <div class="star-rating-front" style="width: <%= review.score*20 %>%">
                    ★★★★★
                  </div>
                  <div class="star-rating-back">
                    ★★★★★
                  </div>
                </div>
                <div class="average-score-display ml-3 pt-2">
                  <%= review.score %>点
                </div>
              </div>
              <div class="content">
                <%= review.store_reviews %>
              </div>
              <div class="content has-text-right">
                ¥<%= review.store_price %>円
              </div>
            </div>
            <footer class="card-footer">
              <p class="card-footer-item">
                <%= review.user.name %>
              </p>
              <p class="card-footer-item">
                <%= review.instrument_name %>
              </p>
              <% if "updated" %>
                <p class="card-footer-item">
                  <%= l review.updated_at, format: :short %>
                </p>
              <% else %>
                <p class="card-footer-item">
                  <%= l review.created_at, format: :short %>
                </p>
              <% end %>
            </footer>
          </div>
          <div class="has-text-right p-3">
            <% if review.user_id == current_user.id %>
              <td><%= link_to "編集", edit_store_review_path(review.store_id, review.id) %></td>
              <td><%= link_to "削除", "reviews/#{review.id}", method: :delete, data: { confirm: '口コミを削除しますか？'} %></td>
            <% end %>
          </div>
        <% end %>
      </div> 
    </div>
  </div>
</section>
